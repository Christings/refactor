{% extends 'father.html' %} {% load tag_tools %} {% block content %}
<div class="row">
	<div class="col-md-6">
		<div class="tile">
			<h3 class="tile-title">添加服务&nbsp;&nbsp;&nbsp;<span style="color:red;font-size:15px;" id="error_xml"></span></h3>
			<div class="tile-body">
				<form class="form-horizontal" method="POST" id="form_fy_addtask">
					{% csrf_token %}
					<div class="form-group row">
						<label class="control-label col-md-2">HubSvn</label>
						<div class="col-md-10">
							<textarea class="form-control" rows="3" style="resize: none;" name="hub_svn" id="hub_svn" placeholder='job.ini[main.svn]'></textarea>
						</div>
					</div>
					<div class="form-group row">
						<label class="control-label col-md-2">Hubcfg</label>
						<div class="col-sm-4">
							<input type="text" class="form-control" id="hub_conf_ip" name="hub_conf_ip" placeholder="ip addr">
						</div>
						<div class="col-sm-3">
							<input type="text" class="form-control" id="hub_conf_user" name="hub_conf_user" placeholder="user">
						</div>
						<div class="col-sm-3">
							<input type="text" class="form-control" id="hub_conf_pass" name="hub_conf_pass" placeholder="password">
						</div>
					</div>
					<div class="form-group row">
						<label class="control-label col-md-2">cfgpath</label>
						<div class="col-md-10">
							<input type="text" class="form-control" id="hub_conf_path" name="hub_conf_path" placeholder="path(e.g.)/search/odin/daemon/fanyi/hub/conf(目录,绝对路径,全量)">
						</div>
					</div>
					<div class="form-group row">
						<label class="control-label col-md-2">datapath</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" id="hub_data_path" name="hub_data_path" placeholder="path(e.g.)/search/odin/daemon/fanyi/hub/data(目录,绝对路径,全量)">
						</div>
					</div>
					<div class="form-group row">
						<label class="control-label col-md-2">ServerSvn</label>
						<div class="col-md-10">
							<textarea class="form-control" rows="3" style="resize: none;" name="server_svn" id="server_svn" placeholder='job.ini[main.svn]'></textarea>
						</div>
					</div>
					<div class="form-group row">
						<label class="control-label col-md-2">Servercfg</label>
						<div class="col-sm-4">
							<input type="text" class="form-control" id="ser_conf_ip" name="ser_conf_ip" placeholder="ip addr">
						</div>
						<div class="col-sm-3">
							<input type="text" class="form-control" id="ser_conf_user" name="ser_conf_user" placeholder="user">
						</div>
						<div class="col-sm-3">
							<input type="text" class="form-control" id="ser_conf_pass" name="ser_conf_pass" placeholder="password">
						</div>
					</div>
					<div class="form-group row">
						<label class="control-label col-md-2">cfgpath</label>
						<div class="col-md-10">
							<input type="text" class="form-control" id="ser_conf_path" name="ser_conf_path" placeholder="path(e.g.)/search/odin/daemon/fanyi/server/conf(目录,绝对路径,全量)">
						</div>
					</div>
					<div class="form-group row">
						<label class="control-label col-md-2">datapath</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" id="ser_data_path" name="ser_data_path" placeholder="path(e.g.)/search/odin/daemon/fanyi/server/data(目录,绝对路径,全量)">
						</div>
					</div>
					<div class="form-group row">
						<label class="control-label col-md-2">querycfg</label>
						<div class="col-sm-4">
							<input type="text" class="form-control" id="query_ip" name="query_ip" placeholder="ip addr">
						</div>
						<div class="col-sm-3">
							<input type="text" class="form-control" id="query_user" name="query_user" placeholder="user">
						</div>
						<div class="col-sm-3">
							<input type="text" class="form-control" id="query_pass" name="query_pass" placeholder="password">
						</div>
					</div>
					<div class="form-group row">
						<label class="control-label col-md-2">querypath</label>
						<div class="col-sm-5">
							<input type="text" class="form-control" id="query_path" name="query_path" placeholder="path(e.g.)/search/odin/daemon/fanyi/query(文件,绝对路径)">
						</div>
						<div class="col-sm-2">
							<select id="lan_sel" name="lan_sel" class="form-control" style="cursor: pointer;">
								<option value="en" selected=""> 英 </option>
								<option value="fr"> 法 </option>
								<option value="ru"> 俄 </option>
								<option value="ko"> 韩 </option>
								<option value="ja"> 日 </option>
								<option value="ar"> 阿拉伯语 </option>
								<option value="de"> 德语 </option>
								<option value="pt"> 葡萄牙语 </option>
								<option value="es"> 西班牙语 </option>
								<option value="hu"> 匈牙利语 </option>
								<option value="it"> 意大利语 </option>
								<option value="pl"> 波兰语 </option>
								<option value="cs"> 捷克语 </option>
								<option value="nl"> 荷兰语 </option>
								<option value="da"> 丹麦语 </option>
								<option value="fi"> 芬兰语 </option>
								<option value="tr"> 土耳其语 </option>
								<option value="sv"> 瑞典语 </option>
								<option value="et" style="display: none;"> 爱沙尼亚语 </option>
								<option value="bg"  style="display: none;"> 保加利亚语 </option>						
								<option value="bs-Latn" style="display: none;"> 波斯尼亚语 </option>
								<option value="fa" style="display: none;"> 波斯语 </option>
								<option value="mww" style="display: none;"> 白苗文 </option>																		
								<option value="tlh-Qaak" style="display: none;"> 克林贡语(piqaD) </option>
								<option value="tlh" style="display: none;"> 克林贡语 </option>
								<option value="hr" style="display: none;"> 克罗地亚语 </option>
								<option value="otq" style="display: none;"> 克雷塔罗奥托米语 </option>
								<option value="ca" style="display: none;"> 加泰隆语 </option>						
								<option value="ro" style="display: none;"> 罗马尼亚语 </option>
								<option value="lv" style="display: none;"> 拉脱维亚语 </option>
								<option value="ht" style="display: none;"> 海地克里奥尔语 </option>
								<option value="lt" style="display: none;"> 立陶宛语 </option>						
								<option value="ms" style="display: none;"> 马来语 </option>
								<option value="mt" style="display: none;"> 马耳他语 </option>						
								<option value="sl" style="display: none;"> 斯洛文尼亚语 </option>
								<option value="th" style="display: none;"> 泰语 </option>						
								<option value="sr-Latn" style="display: none;"> 塞尔维亚语(拉丁文) </option>
								<option value="sr-Cyrl" style="display: none;"> 塞尔维亚语(西里尔文) </option>
								<option value="sk" style="display: none;"> 斯洛伐克语 </option>
								<option value="sw" style="display: none;"> 斯瓦希里语 </option>
								<option value="af" style="display: none;"> 南非荷兰语 </option>
								<option value="no" style="display: none;"> 挪威语 </option>						
								<option value="uk" style="display: none;"> 乌克兰语 </option>
								<option value="ur" style="display: none;"> 乌尔都语 </option>
								<option value="el" style="display: none;"> 希腊语 </option>						
								<option value="cy" style="display: none;"> 威尔士语 </option>
								<option value="yua" style="display: none;"> 尤卡坦玛雅语 </option>
								<option value="he" style="display: none;"> 希伯来语 </option>						
								<option value="hi" style="display: none;"> 印地语 </option>
								<option value="id" style="display: none;"> 印度尼西亚语 </option>
								<option value="vi" style="display: none;"> 越南语 </option>						
								<option value="yue" style="display: none;"> 粤语(繁体) </option>
								<option value="fj" style="display: none;"> 斐济语 </option>
								<option value="FIL" style="display: none;"> 菲律宾语 </option>
								<option value="sm" style="display: none;"> 萨摩亚语 </option>
								<option value="to" style="display: none;"> 汤加语 </option>
								<option value="ty" style="display: none;"> 塔希提语 </option>
								<option value="mg" style="display: none;"> 马尔加什语 </option>
								<option value="bn" style="display: none;"> 孟加拉语 </option>
							</select>
						</div>
						<div class="col-sm-3">
							<label class="radio-inline">
			  					<input type="radio" name="inlineRadioOptions" id="inlineRadio1" value="tozh" checked="checked"> To-zh
							</label>
							<label class="radio-inline">
				 	 			<input type="radio" name="inlineRadioOptions" id="inlineRadio2" value="fromzh"> From-zh
							</label>
						</div>
					</div>
					<div class="form-group row">
						<label class="control-label col-md-2">testtag</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" id="testtag" name="testtag" placeholder="当前测试的备注信息">
						</div>
					</div>
					
				</form>
			</div>
			<div class="tile-footer">
				<div class="row">
					<div class="col-md-9 col-md-offset-2">
						<button class="btn btn-primary" type="button" id="add_fy_task"><i class="fa fa-fw fa-lg fa-check-circle"></i>Add</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="col-md-6">
		<div class="tile">
			<h3 class="tile-title">任务列表</h3>
			<div class="tile-body">
				<table class="table table-hover" id="reqData">
				<thead>
					<tr>
						<td>ID</td>
						<td>CreateTime</td>
						<td>StartTime</td>
						<td>From</td>
						<td>To</td>
						<td>Testtag</td>
						<td>Status</td>						
						<td>User</td>
						<td style="display: none;">Ctrl</td>						
					</tr>
				</thead>
				<tbody style="cursor: pointer;" id="reqBody">
					{% for item in li %}
					<tr>
						<td style="width: 20px;">{{ item.id }}</td>
						<td>{{ item.create_time }}</td>
						<td>{{ item.start_time }}</td>
						<td>{{ item.fromlan }}</td>
						<td>{{ item.tolan }}</td>
						<td>{{ item.testtag }}</td>
						<td>
							<a href="/fanyi/man_eval_detail/?tasknum={{ item.id }}">
								{% ifequal item.status 0 %}
								<button class="btn btn-outline-secondary btn-sm" style="color: cream;">Waiting</button>
								{% endifequal %} 
								{% ifequal item.status 1 %}
								<font color="cream">Ready</font>
								<button class="btn btn-outline-secondary btn-sm" style="color: cream;">Ready</button>
								{% endifequal %} 
								{% ifequal item.status 2 %}
								<button class="btn btn-outline-parimary btn-sm" style="color: cream;">Running</button>
								{% endifequal %} 
								{% ifequal item.status 3 %}
								<button class="btn btn-outline-danger btn-sm" style="color: red;">Error</button>
								{% endifequal %} 
								{% ifequal item.status 4 %}
								<button class="btn btn-outline-success btn-sm" style="color: cream;">Finished</button>
								{% endifequal %} 
								{% ifequal item.status 5 %}
								<button class="btn btn-outline-info btn-sm" style="color: green;">Canceled</button>
								{% endifequal %} 
								{% ifequal item.status 6 %}
								<button class="btn btn-outline-info btn-sm" style="color: green;">Canceling</button>
								{% endifequal %}							
							</a>
						</td>
						<td>{{ item.user }}</td>
						<td style="display: none;">{{ item.hubsvn }}</td>
						<td style="display: none;">{{ item.sersvn }}</td>						
						<td style="display: none;">{{ item.hubcfgip }}</td>
						<td style="display: none;">{{ item.hubcfguser }}</td>
						<td style="display: none;">{{ item.hubcfgpassw }}</td>
						<td style="display: none;">{{ item.hubcfgpath }}</td>
						<td style="display: none;">{{ item.hubdatapath }}</td>
						<td style="display: none;">{{ item.sercfgip }}</td>
						<td style="display: none;">{{ item.sercfguser }}</td>
						<td style="display: none;">{{ item.sercfgpassw }}</td>
						<td style="display: none;">{{ item.sercfgpath }}</td>
						<td style="display: none;">{{ item.serdatapath }}</td>
						<td style="display: none;">{{ item.queryip }}</td>
						<td style="display: none;">{{ item.queyruser }}</td>
						<td style="display: none;">{{ item.querypassw }}</td>
						<td style="display: none;">{{ item.querypath }}</td>
						<td style="display: none;">{{ item.isfromzh }}</td>
						<td style="display: none;">{{ item.lan_sel }}</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
			</div>
			<div id="showDiv"></div>
	        <div class="tile-footer">
	        	<div class="row">
	            <div class="col-md-9 col-md-offset-2">
	            	<nav aria-label="Page navigation">
						<ul class="pagination">
				    		{{page_str}}
						</ul>
					</nav>
	            </div>
	         </div>        	
	        </div>
		</div>
	</div>
</div>


{% endblock %} {% block js %}
<script>
	$(function(){
    		//判断ajax里面的方法是get还是post
    		function csrfSafeMethod(method){
    			return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    		}
    		
			//只要执行一次ajaxSetup进行header设置,就可以不用在没个ajax里面添加header信息了
    		$.ajaxSetup({
    			beforeSend:function(xhr,settings){
    				if(!csrfSafeMethod(settings.type)&&!this.crossDomain){
    					xhr.setRequestHeader('X-CSRFtoken',$.cookie('csrftoken'))
    				}    				
    			}
    		});
			//save
			$('#save_xml').click(function() {
				var reqtext = $('#reqtext').val()
				var inputHost = $('#inputHost').val()
				var lan_sel = $('#lan_sel').val()
				var inlineRadioOptions = $("input[name='inlineRadioOptions']:checked").val()
				var result = $('#result').val()
				var reqtpye = $('#reqtype').val()
				if(reqtext != "" && inputHost != "") {
					$.ajax({
						type: "POST",
						url: "/xml_req_save",
						async: true,
						traditional: true,
						data: {
							'inputHost': inputHost,
							'lan_sel': lan_sel,
							'inlineRadioOptions': inlineRadioOptions,
							'reqtext': reqtext,
							'result': result,
							'reqtype': reqtpye,
						},
						dataType: 'JSON',
						success: function(obj) {
							if(obj.status) {
								location.reload();
							} else {
								$('#error_xml').text(obj.error);
							}
						},
						error: function() {
		
						},
					});
					$('#error_xml').text('');
				} else {
					if(reqtext == '') {
						$('#error_xml').text('Request不可为空。');
					} else if(inputHost == '') {
						$('#error_xml').text('Host不可为空。');
					} else {
						$('#error_xml').text('未知错误。');
					}
				}
			})
		
			//add task
			$('#add_fy_task').click(function() {
				var hub_svn = $('#hub_svn').val()
				var server_svn = $('#server_svn').val()
				if(hub_svn != "" && server_svn != "") {
					$.ajax({
						type: "POST",
						url: "/fanyi/man_eval/",
						async: true,
						traditional: true,
						data: $('#form_fy_addtask').serialize(),
						dataType: 'JSON',
						success: function(obj) {
							console.log(obj.status)
							if(obj.status) {
								location.reload();
							} else {
								$('#error_xml').text(obj.error);
							}
						},
						error: function() {
		
						},
					});
					$('#error_xml').text('');
				} else {
					$('#error_xml').text('svn不可为空');
				}
			})
		
			//table hover
			$(function() {
				function showBox(obj, box) {
					var timer = null;
					$(obj).on("mouseover", function(e) {
						clearTimeout(timer);
						var clientX = e.clientX;
						var clientY = e.clientY;
						var y = clientY + 20;
						var txt = $(this).text();
						timer = setTimeout(function() {
							$(box).css("left", clientX).css("top", y);
							if(txt == "") {
								$(box).hide();
							} else {
								$(box).show();
								$(box).html(txt);
							}
						}, 300);
					});
					$(obj).on("mouseout", function() {
						clearTimeout(timer);
						$(box).hide();
					});
				}
				showBox("#reqData > tbody td", "#showDiv");
			});
		
			//del
			$('.del_line').click(function() {
				var line_id = $(this).parent().parent().attr('req_id');
				$.ajax({
					type: "POST",
					url: "del_xml_line",
					async: true,
					data: {
						'line_id': line_id
					},
					dataType: 'JSON',
					success: function(obj) {
						if(obj.status) {
							location.reload();
						} else {
							$('#error_xml').text(obj.error);
						}
					},
					error: function() {
		
					}
				});
		
			})
		
			//getData
			$('.get_data').dblclick(function() {
				var linelst = $(this).children();
				testtag = $(linelst[5]).text();
				hubsvn = $(linelst[8]).text();
				sersvn = $(linelst[9]).text();
				hubcfgip = $(linelst[10]).text();
				hubcfguser = $(linelst[11]).text();
				hubcfgpassw = $(linelst[12]).text();
				hubcfgpath = $(linelst[13]).text();
				hubdatapath = $(linelst[14]).text();
				sercfgip = $(linelst[15]).text();
				sercfguser = $(linelst[16]).text();
				sercfgpassw = $(linelst[17]).text();
				sercfgpath = $(linelst[18]).text();
				serdatapath = $(linelst[19]).text();
				queryip = $(linelst[20]).text();
				queyruser = $(linelst[21]).text();
				querypassw = $(linelst[22]).text();
				querypath = $(linelst[23]).text();
				isfromzh = $(linelst[24]).text();
				lan_sel = $(linelst[25]).text();
				
				$('#hub_svn').val(hubsvn);
				$('#server_svn').val(sersvn);
				$('#hub_conf_ip').val(hubcfgip);
				$('#hub_conf_user').val(hubcfguser);
				$('#hub_conf_pass').val(hubcfgpassw);
				$('#hub_conf_path').val(hubcfgpath);
				$('#hub_data_path').val(hubdatapath);
				$('#ser_conf_ip').val(sercfgip);
				$('#ser_conf_user').val(sercfguser);
				$('#ser_conf_pass').val(sercfgpassw);
				$('#ser_conf_path').val(sercfgpath);
				$('#ser_data_path').val(serdatapath);
				$('#query_ip').val(queryip);
				$('#query_user').val(queyruser);
				$('#query_pass').val(querypassw);
				$('#query_path').val(querypath);
				$('#testtag').val(testtag);
				$('#lan_sel').val(lan_sel);
				if(isfromzh == 'fromzh') {
					$('#inlineRadio2').attr("checked", 'checked');
					$('#inlineRadio1').attr("checked", false);
				} else {
					$('#inlineRadio1').attr("checked", 'checked');
					$('#inlineRadio2').attr("checked", false);
				}
			})
		
			$('#lan_filter').change(function() {
				var sel_lang = $(this).val();
				console.log(sel_lang)
				if(sel_lang == 'all') {
					$('#reqBody').children().each(function() {
						$(this).removeClass('hide');
					})
				} else {
					$('#reqBody').children().each(function() {
						var line_lang = $(this).attr('lang_type');
						if(sel_lang != line_lang) {
							$(this).addClass('hide');
						} else {
							$(this).removeClass('hide');
						}
					})
		
				}
			})
		})
</script>
{% endblock %}